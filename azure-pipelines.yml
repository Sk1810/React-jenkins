# Node.js with React
# Build a Node.js project that uses React.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '10.x'
  displayName: 'Install Node.js'


- script: |
    npm install
    npm run build   
  displayName: 'npm install and build'


- task: Bash@3
  inputs: 
    targetType: 'inline'
    script: |
      echo '[Action] logging package files'
      ls        
      git stash 
      npm version patch 
      git config user.email karthicksettu52@gmail.com
      git config user.name karthick s
      git diff
      git  add .
      git commit -m "version update [skip ci]"
      git push origin HEAD:master
      echo '[Action] adding token to npmrc'
      echo '//registry.npmjs.org/:_authToken=$(TOKEN)' > .npmrc
      npm publish
    workingDirectory: '.'


- task: GitClone@2
  inputs:
    RepositoryURL: 'https://github.com/Sk1810/React-jenkins.git'
    Branch: 'npm-test'
    FallbackBranch: 'npm-test'
    BaseBranch: 'npm-test'
    Clean: true

 